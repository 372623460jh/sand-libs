"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

function _react() {
  const data = _interopRequireDefault(require("react"));

  _react = function _react() {
    return data;
  };

  return data;
}

function _fs() {
  const data = _interopRequireDefault(require("fs"));

  _fs = function _fs() {
    return data;
  };

  return data;
}

function _path() {
  const data = _interopRequireDefault(require("path"));

  _path = function _path() {
    return data;
  };

  return data;
}

function _child_process() {
  const data = require("child_process");

  _child_process = function _child_process() {
    return data;
  };

  return data;
}

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function getPkgAliasForPath(absPath) {
  const result = [_path().default.basename(absPath), absPath];

  const pkgPath = _path().default.join(absPath, 'package.json'); // use package.name if exists


  if (_fs().default.existsSync(pkgPath)) {
    result[0] = require(pkgPath).name;
  }

  return result;
}

var _default = paths => {
  const isLerna = _fs().default.existsSync(_path().default.join(paths.cwd, 'lerna.json'));

  const pkgs = [];

  if (isLerna) {
    // for lerna repo
    const lernaVersion = (0, _child_process().execSync)(`${_path().default.join(paths.cwd, 'node_modules/.bin/lerna')} -v`).toString();

    if (lernaVersion.startsWith('3')) {
      JSON.parse((0, _child_process().execSync)(`${_path().default.join(paths.cwd, 'node_modules/.bin/lerna')} ls --json`, {
        stdio: 'pipe'
      }).toString()).forEach(pkg => {
        pkgs.push([pkg.name, pkg.location]);
      });
    } else if (require.resolve('lerna/lib/PackageUtilities', {
      paths: [paths.cwd]
    })) {
      // reference: https://github.com/azz/lerna-get-packages/blob/master/index.js
      var PackageUtilities = require(require.resolve('lerna/lib/PackageUtilities', {
        paths: [paths.cwd]
      }));

      var Repository = require(require.resolve('lerna/lib/Repository', {
        paths: [paths.cwd]
      }));

      PackageUtilities.getPackages(new Repository(paths.cwd)).forEach(pkg => {
        pkgs.push([pkg._package.name, pkg._location]);
      });
    }
  } else {
    // for standard repo
    pkgs.push(getPkgAliasForPath(paths.cwd));
  }

  return pkgs;
};

exports.default = _default;